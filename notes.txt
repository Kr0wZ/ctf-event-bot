Workflow :

- DONE - Lancer un nouvel √©v√®nement depuis discord en sp√©cifiant diff√©rents param√®tres (possible uniquement par moi-m√™me) -> !start_event | <NOM> | <DESCRIPTION> | <LIEN> | <NOMBRE_FLAGS> | <DATE_DEBUT> | <DATE_FIN> -> format des dates : JJ-MM-AAAA HH:MM -> attention √† convertir dans le bon format pour ins√©rer dans MySQL -> YYYY-MM-DD HH:MM:SS

- Il est possible de modifier, stopper et supprimer un √©v√®nement.

- DONE - Ev√®nement cr√©√© en avance. On ajoute automatiquement un bouton r√©action pour voir combien de personnes sont potentiellement int√©ress√©es. Quand on cr√©e un event, on cr√©e aussi un r√¥le notification associ√©. Quand quelqu'un clique sur le bouton pour participer alors on va lui donner le r√¥le. Le bot va envoyer un message qui tag les personnes avec le r√¥le quelques heures ? minutes ? avant le d√©but de l'event.
- DONE - Une fois que l'event est lanc√©, il est toujours possible pour un utilisateur de se retirer le r√¥le notification en cliquant de nouveau sur l'emote.
- DONE - A la fin de l'event envoyer un message et tag ceux avec le r√¥le pour leur indiquer la fin. Puis supprimer le r√¥le.
- DONE - Un utilisateur ne peut soumettre que le nombre exact de flags que le challenge accepte. Il n'est pas possible de les supprimer ou modifier ensuite.
- DONE - Quand un utilisateur donne un flag, on v√©rifie s'il (utilisateur) existe d√©j√† dans la base de donn√©es. Si oui alors on cr√©e une nouvelle soumission, sinon on ajoute juste une nouvelle soumission.
- DONE - Pour soumettre un flag, l'utilisateur doit envoyer un message priv√© au bot avec la commande suivante -> !submit <FLAG> -> pas besoin de donner le num√©ro de l'event car il ne peut y avoir qu'un seul event √† la fois. Donc on va chercher dans la BDD celui qui est en "running"
- DONE - La table flag correspond aux flags corrects finaux √† la fin de l'event.
- DONE - Si l'event n'est pas en cours alors le bot n'enregistre pas ce qu'on lui envoie (ignore).
- DONE - Quand un event est annul√© (event pas encore en cours), ne pas notifier les utilisateurs, supprimer le r√¥le et update dans la BDD l'event avec l'√©tat "cancelled".
- DONE - Il est possible d'annuler quand un event est d√©j√† en cours. Dans ce cas, supprimer le r√¥le, update BDD -> cancelled, supprimer tout ce qui correspond √† cet event dans
la bdd -> delete from votes where event_id = event_id, delete from submissions where event_id = event_id, delete from votes where event_id = event_id
- DONE - La difficult√© d'un event est indiqu√©e d√©finitivement √† la fin de l'event. Elle ne peut plus √™tre modifi√©e ensuite. Elle est calcul√©e en faisant la moyenne de tous les flags entr√©s par les utilisateurs pendant l'event.
- DONE - Quand un utilisateur a donn√© un flag au bot, le bot lui r√©pond avec un message qui contient des emotes li√©s au message de 0 √† 10. L'utilisateur doit alors noter en cliquant sur la difficult√© qu'il souhaite donner au flag. Une fois cliqu√©, on ne peut plus modifier ni revenir en arri√®re pour cet event.
- DONE - Si l'utilisateur n'a pas cliqu√© et que l'event est termin√© alors on d√©sactive les boutons et il ne peut plus voter.
- DONE - Si la fin de l'event approche et que l'utilisateur n'a pas not√© la difficult√© de tous les flags qu'il a submit, alors on lui notifie l'oubli du vote. Si pas de r√©ponse quand fin de l'event alors on ne prend pas en compte le vote et on d√©sactive √©galement la possibilit√© de r√©pondre pour cet event.
- DONE - Il faut alors utiliser la commande !add_flag suivi de l'id de l'event ainsi que le nom du flag et le hash correspondant. On doit pr√©ciser l'id de l'event car il peut s'agir d'un ancien event ou de l'event actuel. Il faut effectuer la commande autant de fois qu'il y a de flags pour cet event. On appelle la fonction de calcul des points. Les points sont stock√©s dans la BDD pour chaque utilisateur uniquement √† la fin de l'event quand les coefficients ne peuvent plus changer. On r√©cup√®re les points de chaque utilisateur et on ajoute ceux de l'event qui vient de se terminer.
- DONE - On peut manuellement terminer un event avec la commande !stop. Il faut ensuite ajouter les flags corrects avec !add_flags. 
- DONE - Ajouter la possibilit√© de modifier les flags d'un event. Dans ce cas l√†, il faut recalculer les points des utilisateurs.
On r√©cup√®re la liste des utilisateurs (discord_id) qui avaient l'ancien hash correct, on calcule la difficult√© de l'event (self.compute_points(event_id)), on retire ces points aux utilisateurs (self.assign_points(event_id, ANCIEN_HASH, - POINTS)) -> on ajoute les points n√©gativement pour les retirer.
On update le flag dans la BDD, on check les utilisateurs qui ont le bon flag et on leur rajoute les points calcul√©s juste avant (self.assign_points(event_id, NEW_HASH, POINTS)). -> !update_flag EVENT_ID FLAG_NAME NEW_HASH
- DONE - Possibilit√© de lister les diff√©rents events (simple select dans la BDD avec un filtre sur l'√©tat) -> !upcoming, !running, !finished). Cette liste contient uniquement les informations classiques -> nom event (+ id), date d√©but, date fin et nombre participants (on compte le nombre de soumissions uniques pour chaque utilisateur dans la table submissions par rapport √† un event -> quelque chose comme √ßa : select count(DISTINCT discord_id) from submissions where event_id = X).
- DONE - Affichage du leaderboard global avec la command !leaderboard -> Select name from users ORDER BY points DESC;
- DONE - Ajouter des timeouts pour les commandes de listing des events pour √©viter le spam
- DONE - Pour avoir plus d'informations sur un event (statut de l'event (running, upcoming...), noms des participants, classement, nombre participants, nombre flags, etc...) -> !info <NUMERO_EVENT>
- DONE - Au niveau des soumissions, la vitesse de soumission des flags a son importance. Calculer le first blood au niveau de la BDD lorsqu'on affiche les scores
- DONE - Commande !help pour avoir les commandes disponibles ainsi que les param√®tres pour chaque commande.
- DONE - Infos sur un utilisateur -> !info @KrowZ -> affichage du nombre de points, position dans le classement g√©n√©ral, nombre de participations, nombre flags soumis, nombre de flags corrects, nombre de first bloods, liste des √©v√®nements auxquels il a particip√©.
- DONE - Regarder dans database.py pour retirer les requ√™tes qui ne sont jamais utilis√©es
- DONE - Mettre en embed l'affichage de !info @USER
- DONE - V√©rifier la s√©curit√© des inputs (notamment au niveau de la base de donn√©es) -> utiliser la fonction sanitize
- DONE - Ajouter ->  and message.channel.id == 1085676265270411344 -> dans tous les if(message.content.startswith) -> sauf pour les commandes admin
- DONE - Modifier tous les IDs des channels dans le code pour qu'ils matchent le serveur -> self.current_guild, self.log_channel




Modifications apr√®s tests :


- DONE - Modification de la taille du champ "description" de la bdd (varchar 255 √† varchar 4096)
- DONE - Modifier la notification de secondes √† minutes -> on ne peut pas directement faire time_delta.minutes donc faut convertir les minutes en secondes (minutes_before pass√© en param) puis utiliser time_delta.seconds
Bug √† cause de l'UTC qui n'√©tait pas UTC+1 -> retirer alors une heure (3600 secondes) √† time_delta.seconds
- DONE - Ou bien utiliser sudo timedatectl set-timezone Europe/Paris sur le serveur pour √©viter de modifier tout le code
- DONE - Quand le leaderboard est vide alors ajouter un message correspondant.
- DONE - Quand je cancel un event, le bot va poster un message dans le channel annonce pour pr√©ciser que l'√©v√®nement est annul√© (avant de delete le role pour pouvoir ping tout le monde).
- DONE - Faire pareil pour le !stop_event
- DONE - Quand on fait un !info <EVENT_ID> modifier "Description", "Status" et "URL" en gras + ajouter une ligne entre "Description" et "URL"
- DONE - Avec la commande !stop modifier la ligne 564 et utiliser event_id et event_name au lieu de event[0][1] (car on a d√©j√† r√©cup√©r√© le [0])
- DONE - Ajouter un check sur la taille d'un hash lorsqu'un utilisateur rentre le flag au niveau du bot.
- DONE - En python, forcer uniquemement l'utilisation de caract√®res alphanum√©riques. Faire en sorte qu'il ne soit pas possible d'entrer des choses comme -> ùìàùí∂ùìÅùìäùìâ, ùê´ùê®ùê®ùê≠_ùêüùê•ùêöùê† ou encore des smileys.
- DONE - Prendre en compte le cas o√π la personne rentre le m√™me flag plusieurs fois. Il faut alors v√©rifier quand il rentre le flag que ce m√™me utilisateur ne l'a pas d√©j√† envoy√©. Sinon message d'erreur




- Pendant les tests, la mention everyone a √©t√© enlev√©e pour √©viter le flood. Elle a √©t√© remise.


- Faire les tests de ce qui vient d'√™tre impl√©ment√© (!stop_event, !cancel_event, !submit des flags avec des caract√®res sp√©ciaux + taille trop grande + 2 fois le m√™me flag)







- Dans une version plus pouss√©e du bot, on pourrait cr√©er un event en avance en connaissant d√©j√† les bons flags. Dans ce cas, d√®s qu'un utilisateur submit un flag au bot, on peut directement calculer son nombre de points (il sera modifi√© au fur et √† mesure de l'event en fonction des notes qui sont donn√©es et qui influent sur le score de difficult√© des flags.)

- Bug au niveau du calcul des first bloods (event id 9). V√©rifier qu'on prend bien l'event id dans la requ√™te (dans les tables flags et submissions), qu'on prend uniquement le premier flag d'un utilisateur. Cela vient peut-√™tre du fait de stop un event en avance et d'un recr√©er un autre qui d√©bute et se termine au milieu du premier qui a √©t√© stop.
Ce bug est probl√©matique dans le cas o√π on veut avoir plusieurs events √† la fois.

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------


Setup database:

- Connect to MySQL as root
- Create database: create database ctfs
- Create user: CREATE USER 'discord_bot_user'@'localhost' IDENTIFIED BY 'discord_bot_user';
- Give privileges and apply them: GRANT ALL PRIVILEGES ON ctfs.* TO 'discord_bot_user'@'localhost'; FLUSH PRIVILEGES;


Database tables:

- events : create table events (event_id INT AUTO_INCREMENT PRIMARY KEY, name VARCHAR(255), description VARCHAR(255), url VARCHAR(255), number_of_flags INT DEFAULT 2, starting_date DATETIME, ending_date DATETIME, difficulty INT DEFAULT 0, state INT DEFAULT 0);
- users : create table users (discord_id BIGINT PRIMARY KEY, points INT DEFAULT 0);
- flags : create table flags (flag_id INT AUTO_INCREMENT PRIMARY KEY, name VARCHAR(255), event_id INT, hash VARCHAR(255));
- submissions : create table submissions (submission_id INT AUTO_INCREMENT PRIMARY KEY, discord_id BIGINT, event_id INT, hash VARCHAR(255), date DATETIME);
- votes : create table votes (vote_id INT AUTO_INCREMENT PRIMARY KEY, discord_id BIGINT, event_id INT, note INT DEFAULT 0);


-------------------------------------------------------------------------------------------------------------------------------------------------------------------------


Description d√©taill√©e des tables :

- Un √©v√®nement poss√®de les √©l√©ments suivants :
	- ID (random - unique)
	- Nom
	- Description
	- Difficult√© globale /10 (Moyenne calcul√©e avec la difficult√© des flags en globalit√©) -> par d√©faut 0/10, donc aucun point rajout√© aux flags -> +3 points pour chaque point de difficult√© suppl√©mentaire (donc max 40 points = 10/10)
	- Lien vers le challenge
	- Nombre de flags √† rentrer (par d√©faut 1 flag = 10 points. Peut √™tre modif√© par la difficult√©)
	- Date de d√©but
	- Date de fin
	- Etat (0 -> upcoming, 1 -> running, 2 -> finished, 3 -> cancelled)


- Un utilisateur poss√®de les √©l√©ments suivants :
	- Discord ID (unique)
	- Name (#XXXX)
	- Points

- Un flag (table utilis√©e uniquement pour stocker les flags finaux qui correspondent aux r√©ponses "officielles") poss√®de les √©l√©ments suivants : 
	- Flag ID (random - unique)
	- Nom du flag (user, root ou autre si plus de flags)
	- Event ID (li√© √† events)
	- Hash

- Une soumission poss√®de les √©l√©ments suivants :
	- Submission ID (random - unique)
	- Discord ID (li√© √† users)
	- Event ID (li√© √† events)
	- Hash (string)
	- Date de soumission (date + heure, minutes, secondes)

- Un vote poss√®de les √©l√©ments suivants : (oblig√© de stocker l'information en BDD pour savoir si tel utilisateur a d√©j√† vot√© pour la difficult√© d'un flag)
	- Vote ID (random - unique)
	- Discord ID (li√© √† users)
	- Event ID (li√© √† events)
	- Note (int de 0 √† 10)
